FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential g++ make qtbase5-dev qttools5-dev qtbase5-dev-tools qt5-qmake \
    libxcb-icccm4-dev libxcb-image0-dev libxcb-keysyms1-dev \
    libxcb-randr0-dev libxcb-render-util0-dev libxcb-xinerama0-dev \
    libgl1-mesa-glx x11-apps ca-certificates \
  && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY . /app

RUN qmake client.pro -spec linux-g++ && make -j"$(nproc)"

# Скрипт запуска: использует DISPLAY и X сокет хоста
COPY start-client.sh /usr/local/bin/start-client.sh
RUN chmod +x /usr/local/bin/start-client.sh

CMD ["/usr/local/bin/start-client.sh"]
